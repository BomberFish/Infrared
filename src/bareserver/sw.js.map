{"version":3,"file":"sw.js","sources":["../src/KVAdapter.ts","../src/Meta.ts","../node_modules/depd/lib/browser/index.js","../node_modules/setprototypeof/index.js","../node_modules/statuses/index.js","../node_modules/inherits/inherits_browser.js","../node_modules/toidentifier/index.js","../node_modules/http-errors/index.js","../src/BareServer.ts","../src/encodeProtocol.ts","../src/requestUtil.ts","../src/V1.ts","../src/splitHeaderUtil.ts","../src/V2.ts","../src/createServer.ts","../src/sw.ts"],"sourcesContent":["import type { Database } from './Meta';\n\nexport default class KVAdapter implements Database {\n\tprivate ns: KVNamespace;\n\tconstructor(ns: KVNamespace) {\n\t\tthis.ns = ns;\n\t}\n\tasync get(key: string) {\n\t\treturn (await this.ns.get(key)) as string;\n\t}\n\tasync set(key: string, value: string) {\n\t\tawait this.ns.put(key, value);\n\t}\n\tasync has(key: string) {\n\t\treturn (await this.ns.list()).keys.some((e) => e.name === key);\n\t}\n\tasync delete(key: string) {\n\t\tawait this.ns.delete(key);\n\t\treturn true;\n\t}\n\tasync *entries() {\n\t\tfor (const { name } of (await this.ns.list()).keys)\n\t\t\tyield [name, await this.get(name)] as [string, string];\n\t}\n}\n","import type { BareHeaders, BareRemote } from './requestUtil';\n\nexport interface MetaV1 {\n\tv: 1;\n\tresponse?: {\n\t\theaders: BareHeaders;\n\t};\n}\n\nexport interface MetaV2 {\n\tv: 2;\n\tresponse?: { status: number; statusText: string; headers: BareHeaders };\n\tsendHeaders: BareHeaders;\n\tremote: BareRemote;\n\tforwardHeaders: string[];\n}\n\nexport default interface CommonMeta {\n\tvalue: MetaV1 | MetaV2;\n\texpires: number;\n}\n\nexport interface Database {\n\tget(key: string): string | undefined | PromiseLike<string | undefined>;\n\tset(key: string, value: string): unknown;\n\thas(key: string): boolean | PromiseLike<boolean>;\n\tdelete(key: string): boolean | PromiseLike<boolean>;\n\tentries():\n\t\t| IterableIterator<[string, string]>\n\t\t| AsyncIterableIterator<[string, string]>\n\t\t| PromiseLike<IterableIterator<[string, string]>>\n\t\t| PromiseLike<AsyncIterableIterator<[string, string]>>;\n}\n\n/**\n * @internal\n */\nexport class JSONDatabaseAdapter {\n\timpl: Database;\n\tconstructor(impl: Database) {\n\t\tthis.impl = impl;\n\t}\n\tasync get(key: string) {\n\t\tconst res = await this.impl.get(key);\n\t\tif (typeof res === 'string') return JSON.parse(res) as CommonMeta;\n\t}\n\tasync set(key: string, value: CommonMeta) {\n\t\treturn await this.impl.set(key, JSON.stringify(value));\n\t}\n\tasync has(key: string) {\n\t\treturn await this.impl.has(key);\n\t}\n\tasync delete(key: string) {\n\t\treturn await this.impl.delete(key);\n\t}\n\tasync *[Symbol.asyncIterator]() {\n\t\tfor await (const [id, value] of await this.impl.entries()) {\n\t\t\tyield [id, JSON.parse(value)] as [string, CommonMeta];\n\t\t}\n\t}\n}\n\n/**\n * Routine\n */\nexport async function cleanupDatabase(database: Database) {\n\tconst adapter = new JSONDatabaseAdapter(database);\n\n\tfor await (const [id, { expires }] of adapter)\n\t\tif (expires < Date.now()) database.delete(id);\n}\n","/*!\n * depd\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = depd\n\n/**\n * Create deprecate for namespace in caller.\n */\n\nfunction depd (namespace) {\n  if (!namespace) {\n    throw new TypeError('argument namespace is required')\n  }\n\n  function deprecate (message) {\n    // no-op in browser\n  }\n\n  deprecate._file = undefined\n  deprecate._ignored = true\n  deprecate._namespace = namespace\n  deprecate._traced = false\n  deprecate._warned = Object.create(null)\n\n  deprecate.function = wrapfunction\n  deprecate.property = wrapproperty\n\n  return deprecate\n}\n\n/**\n * Return a wrapped function in a deprecation message.\n *\n * This is a no-op version of the wrapper, which does nothing but call\n * validation.\n */\n\nfunction wrapfunction (fn, message) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('argument fn must be a function')\n  }\n\n  return fn\n}\n\n/**\n * Wrap property in a deprecation message.\n *\n * This is a no-op version of the wrapper, which does nothing but call\n * validation.\n */\n\nfunction wrapproperty (obj, prop, message) {\n  if (!obj || (typeof obj !== 'object' && typeof obj !== 'function')) {\n    throw new TypeError('argument obj must be object')\n  }\n\n  var descriptor = Object.getOwnPropertyDescriptor(obj, prop)\n\n  if (!descriptor) {\n    throw new TypeError('must call property on owner object')\n  }\n\n  if (!descriptor.configurable) {\n    throw new TypeError('property must be configurable')\n  }\n}\n","'use strict'\n/* eslint no-proto: 0 */\nmodule.exports = Object.setPrototypeOf || ({ __proto__: [] } instanceof Array ? setProtoOf : mixinProperties)\n\nfunction setProtoOf (obj, proto) {\n  obj.__proto__ = proto\n  return obj\n}\n\nfunction mixinProperties (obj, proto) {\n  for (var prop in proto) {\n    if (!Object.prototype.hasOwnProperty.call(obj, prop)) {\n      obj[prop] = proto[prop]\n    }\n  }\n  return obj\n}\n","/*!\n * statuses\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar codes = require('./codes.json')\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = status\n\n// status code to message map\nstatus.message = codes\n\n// status message (lower-case) to code map\nstatus.code = createMessageToStatusCodeMap(codes)\n\n// array of status codes\nstatus.codes = createStatusCodeList(codes)\n\n// status codes for redirects\nstatus.redirect = {\n  300: true,\n  301: true,\n  302: true,\n  303: true,\n  305: true,\n  307: true,\n  308: true\n}\n\n// status codes for empty bodies\nstatus.empty = {\n  204: true,\n  205: true,\n  304: true\n}\n\n// status codes for when you should retry the request\nstatus.retry = {\n  502: true,\n  503: true,\n  504: true\n}\n\n/**\n * Create a map of message to status code.\n * @private\n */\n\nfunction createMessageToStatusCodeMap (codes) {\n  var map = {}\n\n  Object.keys(codes).forEach(function forEachCode (code) {\n    var message = codes[code]\n    var status = Number(code)\n\n    // populate map\n    map[message.toLowerCase()] = status\n  })\n\n  return map\n}\n\n/**\n * Create a list of all status codes.\n * @private\n */\n\nfunction createStatusCodeList (codes) {\n  return Object.keys(codes).map(function mapCode (code) {\n    return Number(code)\n  })\n}\n\n/**\n * Get the status code for given message.\n * @private\n */\n\nfunction getStatusCode (message) {\n  var msg = message.toLowerCase()\n\n  if (!Object.prototype.hasOwnProperty.call(status.code, msg)) {\n    throw new Error('invalid status message: \"' + message + '\"')\n  }\n\n  return status.code[msg]\n}\n\n/**\n * Get the status message for given code.\n * @private\n */\n\nfunction getStatusMessage (code) {\n  if (!Object.prototype.hasOwnProperty.call(status.message, code)) {\n    throw new Error('invalid status code: ' + code)\n  }\n\n  return status.message[code]\n}\n\n/**\n * Get the status code.\n *\n * Given a number, this will throw if it is not a known status\n * code, otherwise the code will be returned. Given a string,\n * the string will be parsed for a number and return the code\n * if valid, otherwise will lookup the code assuming this is\n * the status message.\n *\n * @param {string|number} code\n * @returns {number}\n * @public\n */\n\nfunction status (code) {\n  if (typeof code === 'number') {\n    return getStatusMessage(code)\n  }\n\n  if (typeof code !== 'string') {\n    throw new TypeError('code must be a number or string')\n  }\n\n  // '403'\n  var n = parseInt(code, 10)\n  if (!isNaN(n)) {\n    return getStatusMessage(n)\n  }\n\n  return getStatusCode(code)\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      ctor.prototype = Object.create(superCtor.prototype, {\n        constructor: {\n          value: ctor,\n          enumerable: false,\n          writable: true,\n          configurable: true\n        }\n      })\n    }\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    if (superCtor) {\n      ctor.super_ = superCtor\n      var TempCtor = function () {}\n      TempCtor.prototype = superCtor.prototype\n      ctor.prototype = new TempCtor()\n      ctor.prototype.constructor = ctor\n    }\n  }\n}\n","/*!\n * toidentifier\n * Copyright(c) 2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = toIdentifier\n\n/**\n * Trasform the given string into a JavaScript identifier\n *\n * @param {string} str\n * @returns {string}\n * @public\n */\n\nfunction toIdentifier (str) {\n  return str\n    .split(' ')\n    .map(function (token) {\n      return token.slice(0, 1).toUpperCase() + token.slice(1)\n    })\n    .join('')\n    .replace(/[^ _0-9a-z]/gi, '')\n}\n","/*!\n * http-errors\n * Copyright(c) 2014 Jonathan Ong\n * Copyright(c) 2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar deprecate = require('depd')('http-errors')\nvar setPrototypeOf = require('setprototypeof')\nvar statuses = require('statuses')\nvar inherits = require('inherits')\nvar toIdentifier = require('toidentifier')\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = createError\nmodule.exports.HttpError = createHttpErrorConstructor()\nmodule.exports.isHttpError = createIsHttpErrorFunction(module.exports.HttpError)\n\n// Populate exports for all constructors\npopulateConstructorExports(module.exports, statuses.codes, module.exports.HttpError)\n\n/**\n * Get the code class of a status code.\n * @private\n */\n\nfunction codeClass (status) {\n  return Number(String(status).charAt(0) + '00')\n}\n\n/**\n * Create a new HTTP Error.\n *\n * @returns {Error}\n * @public\n */\n\nfunction createError () {\n  // so much arity going on ~_~\n  var err\n  var msg\n  var status = 500\n  var props = {}\n  for (var i = 0; i < arguments.length; i++) {\n    var arg = arguments[i]\n    var type = typeof arg\n    if (type === 'object' && arg instanceof Error) {\n      err = arg\n      status = err.status || err.statusCode || status\n    } else if (type === 'number' && i === 0) {\n      status = arg\n    } else if (type === 'string') {\n      msg = arg\n    } else if (type === 'object') {\n      props = arg\n    } else {\n      throw new TypeError('argument #' + (i + 1) + ' unsupported type ' + type)\n    }\n  }\n\n  if (typeof status === 'number' && (status < 400 || status >= 600)) {\n    deprecate('non-error status code; use only 4xx or 5xx status codes')\n  }\n\n  if (typeof status !== 'number' ||\n    (!statuses.message[status] && (status < 400 || status >= 600))) {\n    status = 500\n  }\n\n  // constructor\n  var HttpError = createError[status] || createError[codeClass(status)]\n\n  if (!err) {\n    // create error\n    err = HttpError\n      ? new HttpError(msg)\n      : new Error(msg || statuses.message[status])\n    Error.captureStackTrace(err, createError)\n  }\n\n  if (!HttpError || !(err instanceof HttpError) || err.status !== status) {\n    // add properties to generic error\n    err.expose = status < 500\n    err.status = err.statusCode = status\n  }\n\n  for (var key in props) {\n    if (key !== 'status' && key !== 'statusCode') {\n      err[key] = props[key]\n    }\n  }\n\n  return err\n}\n\n/**\n * Create HTTP error abstract base class.\n * @private\n */\n\nfunction createHttpErrorConstructor () {\n  function HttpError () {\n    throw new TypeError('cannot construct abstract class')\n  }\n\n  inherits(HttpError, Error)\n\n  return HttpError\n}\n\n/**\n * Create a constructor for a client error.\n * @private\n */\n\nfunction createClientErrorConstructor (HttpError, name, code) {\n  var className = toClassName(name)\n\n  function ClientError (message) {\n    // create the error object\n    var msg = message != null ? message : statuses.message[code]\n    var err = new Error(msg)\n\n    // capture a stack trace to the construction point\n    Error.captureStackTrace(err, ClientError)\n\n    // adjust the [[Prototype]]\n    setPrototypeOf(err, ClientError.prototype)\n\n    // redefine the error message\n    Object.defineProperty(err, 'message', {\n      enumerable: true,\n      configurable: true,\n      value: msg,\n      writable: true\n    })\n\n    // redefine the error name\n    Object.defineProperty(err, 'name', {\n      enumerable: false,\n      configurable: true,\n      value: className,\n      writable: true\n    })\n\n    return err\n  }\n\n  inherits(ClientError, HttpError)\n  nameFunc(ClientError, className)\n\n  ClientError.prototype.status = code\n  ClientError.prototype.statusCode = code\n  ClientError.prototype.expose = true\n\n  return ClientError\n}\n\n/**\n * Create function to test is a value is a HttpError.\n * @private\n */\n\nfunction createIsHttpErrorFunction (HttpError) {\n  return function isHttpError (val) {\n    if (!val || typeof val !== 'object') {\n      return false\n    }\n\n    if (val instanceof HttpError) {\n      return true\n    }\n\n    return val instanceof Error &&\n      typeof val.expose === 'boolean' &&\n      typeof val.statusCode === 'number' && val.status === val.statusCode\n  }\n}\n\n/**\n * Create a constructor for a server error.\n * @private\n */\n\nfunction createServerErrorConstructor (HttpError, name, code) {\n  var className = toClassName(name)\n\n  function ServerError (message) {\n    // create the error object\n    var msg = message != null ? message : statuses.message[code]\n    var err = new Error(msg)\n\n    // capture a stack trace to the construction point\n    Error.captureStackTrace(err, ServerError)\n\n    // adjust the [[Prototype]]\n    setPrototypeOf(err, ServerError.prototype)\n\n    // redefine the error message\n    Object.defineProperty(err, 'message', {\n      enumerable: true,\n      configurable: true,\n      value: msg,\n      writable: true\n    })\n\n    // redefine the error name\n    Object.defineProperty(err, 'name', {\n      enumerable: false,\n      configurable: true,\n      value: className,\n      writable: true\n    })\n\n    return err\n  }\n\n  inherits(ServerError, HttpError)\n  nameFunc(ServerError, className)\n\n  ServerError.prototype.status = code\n  ServerError.prototype.statusCode = code\n  ServerError.prototype.expose = false\n\n  return ServerError\n}\n\n/**\n * Set the name of a function, if possible.\n * @private\n */\n\nfunction nameFunc (func, name) {\n  var desc = Object.getOwnPropertyDescriptor(func, 'name')\n\n  if (desc && desc.configurable) {\n    desc.value = name\n    Object.defineProperty(func, 'name', desc)\n  }\n}\n\n/**\n * Populate the exports object with constructors for every error class.\n * @private\n */\n\nfunction populateConstructorExports (exports, codes, HttpError) {\n  codes.forEach(function forEachCode (code) {\n    var CodeError\n    var name = toIdentifier(statuses.message[code])\n\n    switch (codeClass(code)) {\n      case 400:\n        CodeError = createClientErrorConstructor(HttpError, name, code)\n        break\n      case 500:\n        CodeError = createServerErrorConstructor(HttpError, name, code)\n        break\n    }\n\n    if (CodeError) {\n      // export the constructor\n      exports[code] = CodeError\n      exports[name] = CodeError\n    }\n  })\n}\n\n/**\n * Get a class name from a name identifier.\n * @private\n */\n\nfunction toClassName (name) {\n  return name.substr(-5) !== 'Error'\n    ? name + 'Error'\n    : name\n}\n","import type { JSONDatabaseAdapter } from './Meta.js';\nimport createHttpError from 'http-errors';\n\nexport interface BareErrorBody {\n\tcode: string;\n\tid: string;\n\tmessage?: string;\n\tstack?: string;\n}\n\nexport class BareError extends Error {\n\tstatus: number;\n\tbody: BareErrorBody;\n\tconstructor(status: number, body: BareErrorBody) {\n\t\tsuper(body.message || body.code);\n\t\tthis.status = status;\n\t\tthis.body = body;\n\t}\n}\n\nconst project: BareProject = {\n\tname: 'bare-server-worker',\n\tdescription: 'TOMPHTTP Cloudflare Bare Server',\n\trepository: 'https://github.com/tomphttp/bare-server-worker',\n\tversion: '1.2.2',\n};\n\nexport function json<T>(status: number, json: T) {\n\treturn new Response(JSON.stringify(json, null, '\\t'), {\n\t\tstatus,\n\t\theaders: {\n\t\t\t'content-type': 'application/json',\n\t\t},\n\t});\n}\n\nexport type BareMaintainer = {\n\temail?: string;\n\twebsite?: string;\n};\n\nexport type BareProject = {\n\tname?: string;\n\tdescription?: string;\n\temail?: string;\n\twebsite?: string;\n\trepository?: string;\n\tversion?: string;\n};\n\nexport type BareLanguage =\n\t| 'NodeJS'\n\t| 'ServiceWorker'\n\t| 'Deno'\n\t| 'Java'\n\t| 'PHP'\n\t| 'Rust'\n\t| 'C'\n\t| 'C++'\n\t| 'C#'\n\t| 'Ruby'\n\t| 'Go'\n\t| 'Crystal'\n\t| 'Shell'\n\t| string;\n\nexport type BareManifest = {\n\tmaintainer?: BareMaintainer;\n\tproject?: BareProject;\n\tversions: string[];\n\tlanguage: BareLanguage;\n\tmemoryUsage?: number;\n};\n\nexport interface Options {\n\tlogErrors: boolean;\n\tlocalAddress?: string;\n\tmaintainer?: BareMaintainer;\n\tdatabase: JSONDatabaseAdapter;\n}\n\nexport type RouteCallback = (\n\trequest: Request,\n\toptions: Options\n) => Promise<Response> | Response;\n\nexport default class Server extends EventTarget {\n\troutes = new Map<string, RouteCallback>();\n\tsocketRoutes = new Map<string, RouteCallback>();\n\tprivate closed = false;\n\tprivate directory: string;\n\tprivate options: Options;\n\t/**\n\t * @internal\n\t */\n\tconstructor(directory: string, options: Options) {\n\t\tsuper();\n\t\tthis.directory = directory;\n\t\tthis.options = options;\n\t}\n\t/**\n\t * Remove all timers and listeners\n\t */\n\tclose() {\n\t\tthis.closed = true;\n\t\tthis.dispatchEvent(new Event('close'));\n\t}\n\tshouldRoute(request: Request): boolean {\n\t\treturn (\n\t\t\t!this.closed && new URL(request.url).pathname.startsWith(this.directory)\n\t\t);\n\t}\n\tget instanceInfo(): BareManifest {\n\t\treturn {\n\t\t\tversions: ['v1', 'v2'],\n\t\t\tlanguage: 'Cloudflare',\n\t\t\tmaintainer: this.options.maintainer,\n\t\t\tproject,\n\t\t};\n\t}\n\tasync routeRequest(request: Request) {\n\t\tconst service = new URL(request.url).pathname.slice(\n\t\t\tthis.directory.length - 1\n\t\t);\n\t\tlet response: Response;\n\n\t\tconst isSocket = request.headers.get('upgrade') === 'websocket';\n\n\t\ttry {\n\t\t\tif (request.method === 'OPTIONS') {\n\t\t\t\tresponse = new Response(undefined, { status: 200 });\n\t\t\t} else if (service === '/') {\n\t\t\t\tresponse = json(200, this.instanceInfo);\n\t\t\t} else if (!isSocket && this.routes.has(service)) {\n\t\t\t\tconst call = this.routes.get(service)!;\n\t\t\t\tresponse = await call(request, this.options);\n\t\t\t} else if (isSocket && this.socketRoutes.has(service)) {\n\t\t\t\tconst call = this.socketRoutes.get(service)!;\n\t\t\t\tresponse = await call(request, this.options);\n\t\t\t} else {\n\t\t\t\tthrow new createHttpError.NotFound();\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (this.options.logErrors) console.error(error);\n\n\t\t\tif (createHttpError.isHttpError(error)) {\n\t\t\t\tresponse = json(error.statusCode, {\n\t\t\t\t\tcode: 'UNKNOWN',\n\t\t\t\t\tid: `error.${error.name}`,\n\t\t\t\t\tmessage: error.message,\n\t\t\t\t\tstack: error.stack,\n\t\t\t\t});\n\t\t\t} else if (error instanceof Error) {\n\t\t\t\tresponse = json(500, {\n\t\t\t\t\tcode: 'UNKNOWN',\n\t\t\t\t\tid: `error.${error.name}`,\n\t\t\t\t\tmessage: error.message,\n\t\t\t\t\tstack: error.stack,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tresponse = json(500, {\n\t\t\t\t\tcode: 'UNKNOWN',\n\t\t\t\t\tid: 'error.Exception',\n\t\t\t\t\tmessage: error,\n\t\t\t\t\tstack: new Error(<string | undefined>error).stack,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!(response instanceof Response)) {\n\t\t\t\tif (this.options.logErrors) {\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'Cannot',\n\t\t\t\t\t\trequest.method,\n\t\t\t\t\t\tnew URL(request.url).pathname,\n\t\t\t\t\t\t': Route did not return a response.'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthrow new createHttpError.InternalServerError();\n\t\t\t}\n\t\t}\n\n\t\tresponse.headers.set('x-robots-tag', 'noindex');\n\t\tresponse.headers.set('access-control-allow-headers', '*');\n\t\tresponse.headers.set('access-control-allow-origin', '*');\n\t\tresponse.headers.set('access-control-allow-methods', '*');\n\t\tresponse.headers.set('access-control-expose-headers', '*');\n\t\t// don't fetch preflight on every request...\n\t\t// instead, fetch preflight every 10 minutes\n\t\tresponse.headers.set('access-control-max-age', '7200');\n\n\t\treturn response;\n\t}\n}\n","const validChars =\n\t\"!#$%&'*+-.0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ^_`abcdefghijklmnopqrstuvwxyz|~\";\nconst reserveChar = '%';\n\nexport function validProtocol(protocol: string): boolean {\n\tfor (let i = 0; i < protocol.length; i++) {\n\t\tconst char = protocol[i];\n\n\t\tif (!validChars.includes(char)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function encodeProtocol(protocol: string): string {\n\tlet result = '';\n\n\tfor (let i = 0; i < protocol.length; i++) {\n\t\tconst char = protocol[i];\n\n\t\tif (validChars.includes(char) && char !== reserveChar) {\n\t\t\tresult += char;\n\t\t} else {\n\t\t\tconst code = char.charCodeAt(0);\n\t\t\tresult += reserveChar + code.toString(16).padStart(2, '0');\n\t\t}\n\t}\n\n\treturn result;\n}\n\nexport function decodeProtocol(protocol: string): string {\n\tlet result = '';\n\n\tfor (let i = 0; i < protocol.length; i++) {\n\t\tconst char = protocol[i];\n\n\t\tif (char === reserveChar) {\n\t\t\tconst code = parseInt(protocol.slice(i + 1, i + 3), 16);\n\t\t\tconst decoded = String.fromCharCode(code);\n\n\t\t\tresult += decoded;\n\t\t\ti += 2;\n\t\t} else {\n\t\t\tresult += char;\n\t\t}\n\t}\n\n\treturn result;\n}\n","export interface BareRemote {\n\thost: string;\n\tport: number | string;\n\tpath: string;\n\tprotocol: string;\n}\n\nexport type BareHeaders = Record<string, string | string[]>;\n\nexport function randomHex(byteLength: number) {\n\tconst bytes = new Uint8Array(byteLength);\n\tcrypto.getRandomValues(bytes);\n\tlet hex = '';\n\tfor (const byte of bytes) hex += byte.toString(16).padStart(2, '0');\n\treturn hex;\n}\n\nconst noBody = ['GET', 'HEAD'];\n\nexport async function bareFetch(\n\trequest: Request,\n\tsignal: AbortSignal,\n\trequestHeaders: BareHeaders,\n\tremote: BareRemote\n) {\n\treturn await fetch(\n\t\t`${remote.protocol}//${remote.host}:${remote.port}${remote.path}`,\n\t\t{\n\t\t\theaders: requestHeaders as HeadersInit,\n\t\t\tmethod: request.method,\n\t\t\tbody: noBody.includes(request.method) ? undefined : await request.blob(),\n\t\t\tsignal,\n\t\t\tredirect: 'manual',\n\t\t}\n\t);\n}\n\nexport async function upgradeBareFetch(\n\trequest: Request,\n\tsignal: AbortSignal,\n\trequestHeaders: BareHeaders,\n\tremote: BareRemote\n) {\n\tconst res = await fetch(\n\t\t`${remote.protocol}//${remote.host}:${remote.port}${remote.path}`,\n\t\t{\n\t\t\theaders: requestHeaders as HeadersInit,\n\t\t\tmethod: request.method,\n\t\t\tsignal,\n\t\t}\n\t);\n\n\tif (!res.webSocket) throw new Error(\"server didn't accept WebSocket\");\n\n\treturn [res, res.webSocket] as [Response, WebSocket];\n}\n","import type { RouteCallback } from './BareServer.js';\nimport type Server from './BareServer.js';\nimport { BareError, json } from './BareServer.js';\nimport { decodeProtocol } from './encodeProtocol.js';\nimport type { BareHeaders, BareRemote } from './requestUtil.js';\nimport { upgradeBareFetch } from './requestUtil.js';\nimport { bareFetch, randomHex } from './requestUtil.js';\n\nconst validProtocols: string[] = ['http:', 'https:', 'ws:', 'wss:'];\n\nfunction loadForwardedHeaders(\n\tforward: string[],\n\ttarget: BareHeaders,\n\trequest: Request\n) {\n\tfor (const header of forward) {\n\t\tif (request.headers.has(header)) {\n\t\t\ttarget[header] = request.headers.get(header)!;\n\t\t}\n\t}\n}\n\ninterface BareHeaderData {\n\tremote: BareRemote;\n\theaders: BareHeaders;\n}\n\nfunction readHeaders(request: Request): BareHeaderData {\n\tconst remote: Partial<BareRemote> & { [key: string]: string | number } = {};\n\tconst headers: BareHeaders = {};\n\tReflect.setPrototypeOf(headers, null);\n\n\tfor (const remoteProp of ['host', 'port', 'protocol', 'path']) {\n\t\tconst header = `x-bare-${remoteProp}`;\n\n\t\tif (request.headers.has(header)) {\n\t\t\tconst value = request.headers.get(header)!;\n\n\t\t\tswitch (remoteProp) {\n\t\t\t\tcase 'port':\n\t\t\t\t\tif (isNaN(parseInt(value))) {\n\t\t\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\t\t\tid: `request.headers.${header}`,\n\t\t\t\t\t\t\tmessage: `Header was not a valid integer.`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'protocol':\n\t\t\t\t\tif (!validProtocols.includes(value)) {\n\t\t\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\t\t\tid: `request.headers.${header}`,\n\t\t\t\t\t\t\tmessage: `Header was invalid`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tremote[remoteProp] = value;\n\t\t} else {\n\t\t\tthrow new BareError(400, {\n\t\t\t\tcode: 'MISSING_BARE_HEADER',\n\t\t\t\tid: `request.headers.${header}`,\n\t\t\t\tmessage: `Header was not specified.`,\n\t\t\t});\n\t\t}\n\t}\n\n\tif (request.headers.has('x-bare-headers')) {\n\t\ttry {\n\t\t\tconst json = JSON.parse(request.headers.get('x-bare-headers')!);\n\n\t\t\tfor (const header in json) {\n\t\t\t\tif (typeof json[header] !== 'string' && !Array.isArray(json[header])) {\n\t\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\t\tid: `bare.headers.${header}`,\n\t\t\t\t\t\tmessage: `Header was not a String or Array.`,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tObject.assign(headers, json);\n\t\t} catch (error) {\n\t\t\tif (error instanceof SyntaxError) {\n\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\tid: `request.headers.x-bare-headers`,\n\t\t\t\t\tmessage: `Header contained invalid JSON. (${error.message})`,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'MISSING_BARE_HEADER',\n\t\t\tid: `request.headers.x-bare-headers`,\n\t\t\tmessage: `Header was not specified.`,\n\t\t});\n\t}\n\n\tif (request.headers.has('x-bare-forward-headers')) {\n\t\tlet json;\n\n\t\ttry {\n\t\t\tjson = JSON.parse(request.headers.get('x-bare-forward-headers')!);\n\t\t} catch (error) {\n\t\t\tthrow new BareError(400, {\n\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\tid: `request.headers.x-bare-forward-headers`,\n\t\t\t\tmessage: `Header contained invalid JSON. (${\n\t\t\t\t\terror instanceof Error ? error.message : error\n\t\t\t\t})`,\n\t\t\t});\n\t\t}\n\n\t\tloadForwardedHeaders(json, headers, request);\n\t} else {\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'MISSING_BARE_HEADER',\n\t\t\tid: `request.headers.x-bare-forward-headers`,\n\t\t\tmessage: `Header was not specified.`,\n\t\t});\n\t}\n\n\treturn { remote: <BareRemote>remote, headers };\n}\n\nconst tunnelRequest: RouteCallback = async (request) => {\n\tconst { remote, headers } = readHeaders(request);\n\n\tconst response = await bareFetch(request, request.signal, headers, remote);\n\n\tconst responseHeaders = new Headers();\n\n\tfor (const [header, value] of response.headers) {\n\t\tif (header === 'content-encoding' || header === 'x-content-encoding')\n\t\t\tresponseHeaders.set('content-encoding', value);\n\t\telse if (header === 'content-length')\n\t\t\tresponseHeaders.set('content-length', value);\n\t}\n\n\tresponseHeaders.set(\n\t\t'x-bare-headers',\n\t\tJSON.stringify(Object.fromEntries(response.headers))\n\t);\n\n\tresponseHeaders.set('x-bare-status', response.status.toString());\n\tresponseHeaders.set('x-bare-status-text', response.statusText);\n\n\treturn new Response(response.body, { status: 200, headers: responseHeaders });\n};\n\nconst metaExpiration = 30e3;\n\nconst wsMeta: RouteCallback = async (request, options) => {\n\tif (request.method === 'OPTIONS') {\n\t\treturn new Response(undefined, { status: 200 });\n\t}\n\n\tif (!request.headers.has('x-bare-id')) {\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'MISSING_BARE_HEADER',\n\t\t\tid: 'request.headers.x-bare-id',\n\t\t\tmessage: 'Header was not specified',\n\t\t});\n\t}\n\n\tconst id = request.headers.get('x-bare-id')!;\n\tconst meta = await options.database.get(id);\n\n\t// check if meta isn't undefined and if the version equals 1\n\tif (meta?.value.v !== 1)\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\tid: 'request.headers.x-bare-id',\n\t\t\tmessage: 'Unregistered ID',\n\t\t});\n\n\tawait options.database.delete(id);\n\n\treturn json(200, {\n\t\theaders: meta.value.response?.headers,\n\t});\n};\n\nconst wsNewMeta: RouteCallback = async (request, options) => {\n\tconst id = randomHex(16);\n\n\tawait options.database.set(id, {\n\t\tvalue: { v: 1 },\n\t\texpires: Date.now() + metaExpiration,\n\t});\n\n\treturn new Response(id);\n};\n\nconst tunnelSocket: RouteCallback = async (request, options) => {\n\tconst [firstProtocol, data] =\n\t\trequest.headers.get('sec-websocket-protocol')?.split(/,\\s*/g) || [];\n\n\tif (firstProtocol !== 'bare')\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\tid: `request.headers.sec-websocket-protocol`,\n\t\t\tmessage: `Meta was not specified.`,\n\t\t});\n\n\tconst {\n\t\tremote,\n\t\theaders,\n\t\tforward_headers: forwardHeaders,\n\t\tid,\n\t} = JSON.parse(decodeProtocol(data));\n\n\tloadForwardedHeaders(forwardHeaders, headers, request);\n\n\tif (!id)\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\tid: `request.headers.sec-websocket-protocol`,\n\t\t\tmessage: `Expected ID.`,\n\t\t});\n\n\tconst [remoteResponse, remoteSocket] = await upgradeBareFetch(\n\t\trequest,\n\t\trequest.signal,\n\t\theaders,\n\t\tremote\n\t);\n\n\tconst meta = await options.database.get(id);\n\n\tif (meta?.value.v === 1) {\n\t\tmeta.value.response = {\n\t\t\theaders: Object.fromEntries(remoteResponse.headers),\n\t\t};\n\t\tawait options.database.set(id, meta);\n\t}\n\n\treturn new Response(undefined, {\n\t\tstatus: 101,\n\t\twebSocket: remoteSocket,\n\t});\n};\n\nexport default function registerV1(server: Server) {\n\tserver.routes.set('/v1/', tunnelRequest);\n\tserver.routes.set('/v1/ws-new-meta', wsNewMeta);\n\tserver.routes.set('/v1/ws-meta', wsMeta);\n\tserver.socketRoutes.set('/v1/', tunnelSocket);\n}\n","import { BareError } from './BareServer.js';\n\nconst MAX_HEADER_VALUE = 3072;\n\n/**\n *\n * Splits headers according to spec\n * @param headers\n * @returns Split headers\n */\nexport function splitHeaders(headers: Headers): Headers {\n\tconst output = new Headers(headers);\n\n\tif (headers.has('x-bare-headers')) {\n\t\tconst value = headers.get('x-bare-headers')!;\n\n\t\tif (value.length > MAX_HEADER_VALUE) {\n\t\t\toutput.delete('x-bare-headers');\n\n\t\t\tlet split = 0;\n\n\t\t\tfor (let i = 0; i < value.length; i += MAX_HEADER_VALUE) {\n\t\t\t\tconst part = value.slice(i, i + MAX_HEADER_VALUE);\n\n\t\t\t\tconst id = split++;\n\t\t\t\toutput.set(`x-bare-headers-${id}`, `;${part}`);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn output;\n}\n\n/**\n * Joins headers according to spec\n * @param headers\n * @returns Joined headers\n */\nexport function joinHeaders(headers: Headers): Headers {\n\tconst output = new Headers(headers);\n\n\tconst prefix = 'x-bare-headers';\n\n\tif (headers.has(`${prefix}-0`)) {\n\t\tconst join: string[] = [];\n\n\t\tfor (const [header, value] of headers) {\n\t\t\tif (!header.startsWith(prefix)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!value.startsWith(';')) {\n\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\tid: `request.headers.${header}`,\n\t\t\t\t\tmessage: `Value didn't begin with semi-colon.`,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst id = parseInt(header.slice(prefix.length + 1));\n\n\t\t\tjoin[id] = value.slice(1);\n\n\t\t\toutput.delete(header);\n\t\t}\n\n\t\toutput.set(prefix, join.join(''));\n\t}\n\n\treturn output;\n}\n","import type { RouteCallback } from './BareServer.js';\nimport { BareError } from './BareServer.js';\nimport type Server from './BareServer.js';\nimport type { BareHeaders, BareRemote } from './requestUtil.js';\nimport { upgradeBareFetch } from './requestUtil.js';\nimport { bareFetch, randomHex } from './requestUtil.js';\nimport { joinHeaders, splitHeaders } from './splitHeaderUtil.js';\n\nconst validProtocols: string[] = ['http:', 'https:', 'ws:', 'wss:'];\n\nconst forbiddenForwardHeaders: string[] = [\n\t'connection',\n\t'transfer-encoding',\n\t'host',\n\t'connection',\n\t'origin',\n\t'referer',\n];\n\nconst forbiddenPassHeaders: string[] = [\n\t'vary',\n\t'connection',\n\t'transfer-encoding',\n\t'access-control-allow-headers',\n\t'access-control-allow-methods',\n\t'access-control-expose-headers',\n\t'access-control-max-age',\n\t'access-control-request-headers',\n\t'access-control-request-method',\n];\n\n// common defaults\nconst defaultForwardHeaders: string[] = [\n\t'accept-encoding',\n\t'accept-language',\n\t'sec-websocket-extensions',\n\t'sec-websocket-key',\n\t'sec-websocket-version',\n];\n\nconst defaultPassHeaders: string[] = [\n\t'content-encoding',\n\t'content-length',\n\t'last-modified',\n];\n\n// defaults if the client provides a cache key\nconst defaultCacheForwardHeaders: string[] = [\n\t'if-modified-since',\n\t'if-none-match',\n\t'cache-control',\n];\n\nconst defaultCachePassHeaders: string[] = ['cache-control', 'etag'];\n\nconst cacheNotModified = 304;\n\nfunction loadForwardedHeaders(\n\tforward: string[],\n\ttarget: BareHeaders,\n\trequest: Request\n) {\n\tfor (const header of forward) {\n\t\tif (request.headers.has(header)) {\n\t\t\ttarget[header] = request.headers.get(header)!;\n\t\t}\n\t}\n}\n\nconst splitHeaderValue = /,\\s*/g;\n\ninterface BareHeaderData {\n\tremote: BareRemote;\n\tsendHeaders: BareHeaders;\n\tpassHeaders: string[];\n\tpassStatus: number[];\n\tforwardHeaders: string[];\n}\n\nfunction readHeaders(request: Request): BareHeaderData {\n\tconst remote = Object.setPrototypeOf({}, null);\n\tconst sendHeaders = Object.setPrototypeOf({}, null);\n\tconst passHeaders = [...defaultPassHeaders];\n\tconst passStatus = [];\n\tconst forwardHeaders = [...defaultForwardHeaders];\n\n\t// should be unique\n\tconst cache = new URL(request.url).searchParams.has('cache');\n\n\tif (cache) {\n\t\tpassHeaders.push(...defaultCachePassHeaders);\n\t\tpassStatus.push(cacheNotModified);\n\t\tforwardHeaders.push(...defaultCacheForwardHeaders);\n\t}\n\n\tconst headers = joinHeaders(request.headers);\n\n\tfor (const remoteProp of ['host', 'port', 'protocol', 'path']) {\n\t\tconst header = `x-bare-${remoteProp}`;\n\n\t\tif (headers.has(header)) {\n\t\t\tconst value = headers.get(header)!;\n\n\t\t\tswitch (remoteProp) {\n\t\t\t\tcase 'port':\n\t\t\t\t\tif (isNaN(parseInt(value))) {\n\t\t\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\t\t\tid: `request.headers.${header}`,\n\t\t\t\t\t\t\tmessage: `Header was not a valid integer.`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'protocol':\n\t\t\t\t\tif (!validProtocols.includes(value)) {\n\t\t\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\t\t\tid: `request.headers.${header}`,\n\t\t\t\t\t\t\tmessage: `Header was invalid`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tremote[remoteProp] = value;\n\t\t} else {\n\t\t\tthrow new BareError(400, {\n\t\t\t\tcode: 'MISSING_BARE_HEADER',\n\t\t\t\tid: `request.headers.${header}`,\n\t\t\t\tmessage: `Header was not specified.`,\n\t\t\t});\n\t\t}\n\t}\n\n\tif (headers.has('x-bare-headers')) {\n\t\ttry {\n\t\t\tconst json = JSON.parse(headers.get('x-bare-headers')!);\n\n\t\t\tfor (const header in json) {\n\t\t\t\tconst value = json[header];\n\n\t\t\t\tif (typeof value === 'string') {\n\t\t\t\t\tsendHeaders[header] = value;\n\t\t\t\t} else if (Array.isArray(value)) {\n\t\t\t\t\tconst array = [];\n\n\t\t\t\t\tfor (const val in value) {\n\t\t\t\t\t\tif (typeof val !== 'string') {\n\t\t\t\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\t\t\t\tid: `bare.headers.${header}`,\n\t\t\t\t\t\t\t\tmessage: `Header was not a String.`,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.push(val);\n\t\t\t\t\t}\n\n\t\t\t\t\tsendHeaders[header] = array;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\t\tid: `bare.headers.${header}`,\n\t\t\t\t\t\tmessage: `Header was not a String.`,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (error instanceof SyntaxError) {\n\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\tid: `request.headers.x-bare-headers`,\n\t\t\t\t\tmessage: `Header contained invalid JSON. (${error.message})`,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'MISSING_BARE_HEADER',\n\t\t\tid: `request.headers.x-bare-headers`,\n\t\t\tmessage: `Header was not specified.`,\n\t\t});\n\t}\n\n\tif (headers.has('x-bare-pass-status')) {\n\t\tconst parsed = headers.get('x-bare-pass-status')!.split(splitHeaderValue);\n\n\t\tfor (const value of parsed) {\n\t\t\tconst number = parseInt(value);\n\n\t\t\tif (isNaN(number)) {\n\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\t\t\tid: `request.headers.x-bare-pass-status`,\n\t\t\t\t\tmessage: `Array contained non-number value.`,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tpassStatus.push(number);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (headers.has('x-bare-pass-headers')) {\n\t\tconst parsed = headers.get('x-bare-pass-headers')!.split(splitHeaderValue);\n\n\t\tfor (let header of parsed) {\n\t\t\theader = header.toLowerCase();\n\n\t\t\tif (forbiddenPassHeaders.includes(header)) {\n\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\tcode: 'FORBIDDEN_BARE_HEADER',\n\t\t\t\t\tid: `request.headers.x-bare-forward-headers`,\n\t\t\t\t\tmessage: `A forbidden header was passed.`,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tpassHeaders.push(header);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (headers.has('x-bare-forward-headers')) {\n\t\tconst parsed = headers\n\t\t\t.get('x-bare-forward-headers')!\n\t\t\t.split(splitHeaderValue);\n\n\t\tfor (let header of parsed) {\n\t\t\theader = header.toLowerCase();\n\n\t\t\tif (forbiddenForwardHeaders.includes(header)) {\n\t\t\t\tthrow new BareError(400, {\n\t\t\t\t\tcode: 'FORBIDDEN_BARE_HEADER',\n\t\t\t\t\tid: `request.headers.x-bare-forward-headers`,\n\t\t\t\t\tmessage: `A forbidden header was forwarded.`,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tforwardHeaders.push(header);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tremote,\n\t\tsendHeaders,\n\t\tpassHeaders,\n\t\tpassStatus,\n\t\tforwardHeaders,\n\t};\n}\n\nconst tunnelRequest: RouteCallback = async (request) => {\n\tconst { remote, sendHeaders, passHeaders, passStatus, forwardHeaders } =\n\t\treadHeaders(request);\n\n\tloadForwardedHeaders(forwardHeaders, sendHeaders, request);\n\n\tconst response = await bareFetch(\n\t\trequest,\n\t\trequest.signal,\n\t\tsendHeaders,\n\t\tremote\n\t);\n\n\tconst responseHeaders = new Headers();\n\n\tfor (const [header, value] of passHeaders) {\n\t\tif (!response.headers.has(header)) continue;\n\t\tresponseHeaders.set(header, value);\n\t}\n\n\tconst status = passStatus.includes(response.status) ? response.status : 200;\n\n\tif (status !== cacheNotModified) {\n\t\tresponseHeaders.set('x-bare-status', response.status.toString());\n\t\tresponseHeaders.set('x-bare-status-text', response.statusText);\n\t\tresponseHeaders.set(\n\t\t\t'x-bare-headers',\n\t\t\tJSON.stringify(Object.fromEntries(response.headers))\n\t\t);\n\t}\n\n\treturn new Response(response.body, {\n\t\tstatus,\n\t\theaders: splitHeaders(responseHeaders),\n\t});\n};\n\nconst metaExpiration = 30e3;\n\nconst getMeta: RouteCallback = async (request, options) => {\n\tif (request.method === 'OPTIONS') {\n\t\treturn new Response(undefined, { status: 200 });\n\t}\n\n\tif (!request.headers.has('x-bare-id')) {\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'MISSING_BARE_HEADER',\n\t\t\tid: 'request.headers.x-bare-id',\n\t\t\tmessage: 'Header was not specified',\n\t\t});\n\t}\n\n\tconst id = request.headers.get('x-bare-id')!;\n\tconst meta = await options.database.get(id);\n\n\tif (meta?.value.v !== 2)\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\tid: 'request.headers.x-bare-id',\n\t\t\tmessage: 'Unregistered ID',\n\t\t});\n\n\tif (!meta.value.response)\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\tid: 'request.headers.x-bare-id',\n\t\t\tmessage: 'Meta not ready',\n\t\t});\n\n\tawait options.database.delete(id);\n\n\tconst responseHeaders = new Headers();\n\n\tresponseHeaders.set('x-bare-status', meta.value.response.status.toString());\n\tresponseHeaders.set('x-bare-status-text', meta.value.response.statusText);\n\tresponseHeaders.set(\n\t\t'x-bare-headers',\n\t\tJSON.stringify(meta.value.response.headers)\n\t);\n\n\treturn new Response(undefined, {\n\t\tstatus: 200,\n\t\theaders: splitHeaders(responseHeaders),\n\t});\n};\n\nconst newMeta: RouteCallback = async (request, options) => {\n\tconst { remote, sendHeaders, forwardHeaders } = readHeaders(request);\n\n\tconst id = randomHex(16);\n\n\tawait options.database.set(id, {\n\t\texpires: Date.now() + metaExpiration,\n\t\tvalue: {\n\t\t\tv: 2,\n\t\t\tremote,\n\t\t\tsendHeaders,\n\t\t\tforwardHeaders,\n\t\t},\n\t});\n\n\treturn new Response(id);\n};\n\nconst tunnelSocket: RouteCallback = async (request, options) => {\n\tconst id = request.headers.get('sec-websocket-protocol');\n\n\tif (!id)\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\tid: `request.headers.sec-websocket-protocol`,\n\t\t\tmessage: `Expected ID.`,\n\t\t});\n\n\tconst meta = await options.database.get(id);\n\n\tif (meta?.value.v !== 2)\n\t\tthrow new BareError(400, {\n\t\t\tcode: 'INVALID_BARE_HEADER',\n\t\t\tid: `request.headers.sec-websocket-protocol`,\n\t\t\tmessage: `Bad ID.`,\n\t\t});\n\n\tloadForwardedHeaders(\n\t\tmeta.value.forwardHeaders,\n\t\tmeta.value.sendHeaders,\n\t\trequest\n\t);\n\n\tconst [remoteResponse, remoteSocket] = await upgradeBareFetch(\n\t\trequest,\n\t\trequest.signal,\n\t\tmeta.value.sendHeaders,\n\t\tmeta.value.remote\n\t);\n\n\t// https://developers.cloudflare.com/workers/learning/using-websockets\n\t// returning it on to a client....\n\tmeta.value.response = {\n\t\theaders: Object.fromEntries(remoteResponse.headers),\n\t\tstatus: remoteResponse.status,\n\t\tstatusText: remoteResponse.statusText,\n\t};\n\n\tawait options.database.set(id, meta);\n\n\treturn new Response(undefined, {\n\t\tstatus: 101,\n\t\twebSocket: remoteSocket,\n\t});\n};\n\nexport default function registerV2(server: Server) {\n\tserver.routes.set('/v2/', tunnelRequest);\n\tserver.routes.set('/v2/ws-new-meta', newMeta);\n\tserver.routes.set('/v2/ws-meta', getMeta);\n\tserver.socketRoutes.set('/v2/', tunnelSocket);\n}\n","import BareServer from './BareServer.js';\nimport type { BareMaintainer } from './BareServer.js';\nimport type { Database } from './Meta.js';\nimport { JSONDatabaseAdapter } from './Meta.js';\nimport { cleanupDatabase } from './Meta.js';\nimport registerV1 from './V1.js';\nimport registerV2 from './V2.js';\n\ninterface BareServerInit {\n\tlogErrors?: boolean;\n\tlocalAddress?: string;\n\tmaintainer?: BareMaintainer;\n\tdatabase?: Database;\n}\n\n/**\n * Create a Bare server.\n * This will handle all lifecycles for unspecified options (httpAgent, httpsAgent, metaMap).\n */\nexport default function createBareServer(\n\tdirectory: string,\n\tinit: BareServerInit = {}\n) {\n\tif (typeof directory !== 'string')\n\t\tthrow new Error('Directory must be specified.');\n\tif (!directory.startsWith('/') || !directory.endsWith('/'))\n\t\tthrow new RangeError('Directory must start and end with /');\n\tinit.logErrors ??= false;\n\n\tconst cleanup: (() => void)[] = [];\n\n\tif (!init.database) {\n\t\tconst database = new Map<string, string>();\n\t\tconst interval = setInterval(() => cleanupDatabase(database), 1000);\n\t\tinit.database = database;\n\t\tcleanup.push(() => clearInterval(interval));\n\t}\n\n\tconst server = new BareServer(directory, <\n\t\tRequired<BareServerInit> & { database: JSONDatabaseAdapter }\n\t>{\n\t\t...init,\n\t\tdatabase: new JSONDatabaseAdapter(init.database),\n\t});\n\tregisterV1(server);\n\tregisterV2(server);\n\n\tserver.addEventListener('close', () => {\n\t\tfor (const cb of cleanup) cb();\n\t});\n\n\treturn server;\n}\n","import KVAdapter from './KVAdapter.js';\nimport { cleanupDatabase } from './Meta.js';\nimport createBareServer from './createServer.js';\n\nconst kvDB = new KVAdapter(BARE);\n\nconst bare = createBareServer('/', {\n\tlogErrors: true,\n\tdatabase: kvDB,\n});\n\naddEventListener('fetch', (event) => {\n\tcleanupDatabase(kvDB);\n\tif (bare.shouldRoute(event.request))\n\t\tevent.respondWith(bare.routeRequest(event.request));\n});\n"],"names":["KVAdapter","ns","constructor","get","key","set","value","put","has","list","keys","some","e","name","delete","entries","JSONDatabaseAdapter","impl","res","JSON","parse","stringify","Symbol","asyncIterator","id","cleanupDatabase","database","adapter","expires","Date","now","inherits_browserModule","require$$0","require$$1","statuses","require$$2","require$$3","require$$4","BareError","Error","status","body","message","code","project","description","repository","version","json","Response","headers","Server","EventTarget","routes","Map","socketRoutes","closed","directory","options","close","dispatchEvent","Event","shouldRoute","request","URL","url","pathname","startsWith","instanceInfo","versions","language","maintainer","routeRequest","service","slice","length","response","isSocket","method","undefined","call","createHttpError","NotFound","error","logErrors","console","isHttpError","statusCode","stack","InternalServerError","reserveChar","decodeProtocol","protocol","result","i","char","parseInt","decoded","String","fromCharCode","randomHex","byteLength","bytes","Uint8Array","crypto","getRandomValues","hex","byte","toString","padStart","noBody","bareFetch","signal","requestHeaders","remote","fetch","host","port","path","includes","blob","redirect","upgradeBareFetch","webSocket","validProtocols","loadForwardedHeaders","forward","target","header","readHeaders","Reflect","setPrototypeOf","remoteProp","isNaN","Array","isArray","Object","assign","SyntaxError","tunnelRequest","responseHeaders","Headers","fromEntries","statusText","metaExpiration","wsMeta","meta","v","wsNewMeta","tunnelSocket","firstProtocol","data","split","forward_headers","forwardHeaders","remoteResponse","remoteSocket","registerV1","server","MAX_HEADER_VALUE","splitHeaders","output","part","joinHeaders","prefix","join","forbiddenForwardHeaders","forbiddenPassHeaders","defaultForwardHeaders","defaultPassHeaders","defaultCacheForwardHeaders","defaultCachePassHeaders","cacheNotModified","splitHeaderValue","sendHeaders","passHeaders","passStatus","cache","searchParams","push","array","val","parsed","number","toLowerCase","getMeta","newMeta","registerV2","createBareServer","init","endsWith","RangeError","cleanup","interval","setInterval","clearInterval","BareServer","addEventListener","cb","kvDB","BARE","bare","event","respondWith"],"mappings":"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"}